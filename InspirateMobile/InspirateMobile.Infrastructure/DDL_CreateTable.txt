

CREATE TABLE CATEGORIA_ITEM (
    IDCATEGORIAITEM      INTEGER NOT NULL,
    TITULO  VARCHAR2(255) NOT NULL
);

ALTER TABLE CATEGORIA_ITEM ADD CONSTRAINT CATEGORIA_ITEM_PK PRIMARY KEY (IDCATEGORIAITEM);

CREATE TABLE INTERESSE (
    IDINTERESSE               INTEGER NOT NULL,
    IDUSUARIO        INTEGER NOT NULL,
    IDOFERTA         INTEGER NOT NULL,
    DATA             TIMESTAMP NOT NULL,
    SITUACAONEGOCIO  INTEGER NOT NULL
);

COMMENT ON COLUMN INTERESSE.SITUACAONEGOCIO IS
    '0 -> PENDENTE
1 -> NEGÓCIO FECHADO
2 -> NEGÓCIO FECHADO PARCIALMENTE
-1 -> CANCELADO';

ALTER TABLE INTERESSE ADD CONSTRAINT INTERESSE_PK PRIMARY KEY (IDINTERESSE);

CREATE TABLE INTERESSE_ITEM (
    IDINTERESSEITEM  INTEGER NOT NULL,
    IDINTERESSE      INTEGER NOT NULL,
    IDOFERTAITEMS    INTEGER NOT NULL,
    QUANTIDADE       NUMBER(8) NOT NULL,
    SITUACAONEGOCIO  INTEGER NOT NULL
);

COMMENT ON COLUMN INTERESSE_ITEM.SITUACAONEGOCIO IS
    '0 -> PENDENTE
1 -> NEGÓCIO FECHADO
-1 -> CANCELADO';

ALTER TABLE INTERESSE_ITEM ADD CONSTRAINT INTERESSE_ITEM_PK PRIMARY KEY (IDINTERESSEITEM);

CREATE TABLE MENSAGEM (
    IDMENSAGEM             INTEGER NOT NULL,
    IDUSUARIOREMETENTE     INTEGER NOT NULL,
    IDUSUARIODESTINATARIO  INTEGER NOT NULL,
    MENSAGEM               VARCHAR2(1024) NOT NULL,
    DATAENVIO              TIMESTAMP NOT NULL,
    DATALEITURA            TIMESTAMP
);

ALTER TABLE MENSAGEM ADD CONSTRAINT MENSAGEM_PK PRIMARY KEY (IDMENSAGEM);

CREATE TABLE OFERTA (
    IDOFERTA   INTEGER NOT NULL,
    IDUSUARIO   INTEGER NOT NULL,
    DESCRICAO   VARCHAR2(255) NOT NULL,
    TIPOOFERTA  INTEGER NOT NULL,
    DATA        TIMESTAMP NOT NULL,
    SITUACAO    INTEGER NOT NULL
);

COMMENT ON COLUMN OFERTA.TIPOOFERTA IS
    '1 => TENHO O PRODUTO E ESTOU O OFERTANDO
2 => TENHO INTERESSE NESSE PRODUTO';

COMMENT ON COLUMN OFERTA.SITUACAO IS
    '0 -> ABERTA
1 -> CONCLUIDA
-1 -> CANCELADA/EXCLUIDA';

ALTER TABLE OFERTA ADD CONSTRAINT OFERTA_PK PRIMARY KEY (IDOFERTA);

CREATE TABLE OFERTA_ITEMS (
    IDOFERTAITEMS     INTEGER NOT NULL,
    IDOFERTA          INTEGER NOT NULL,
    IDCATEGORIAITEM   INTEGER NOT NULL,
    TITULO            VARCHAR2(255) NOT NULL,
    QUANTIDADE        NUMBER(8) NOT NULL,
    QUANTIDADEMINIMA  NUMBER(8),
    QUANTIDADEPACOTE  NUMBER(8),
    UNIDADEMEDIDA     VARCHAR2(255) NOT NULL,
    SITUACAO          INTEGER NOT NULL
);

COMMENT ON COLUMN OFERTA_ITEMS.SITUACAO IS
    '0 -> ABERTA
1 -> CONCLUIDA
-1 -> CANCELADA/EXCLUIDA';

ALTER TABLE OFERTA_ITEMS ADD CONSTRAINT OFERTA_ITEMS_PK PRIMARY KEY (IDOFERTAITEMS);

CREATE TABLE USUARIO (
    IDUSUARIO        INTEGER NOT NULL,
    NOME      VARCHAR2(255) NOT NULL,
    USUARIO   VARCHAR2(255) NOT NULL,
    SENHA     VARCHAR2(255) NOT NULL,
    TELEFONE  VARCHAR2(255) NOT NULL,
    EMAIL     VARCHAR2(255) NOT NULL,
    SITUACAO  INTEGER NOT NULL,
    TIPOUSUARIO INTEGER NOT NULL,
    DATACRIACAO TIMESTAMP NOT NULL,
    DATAATUALIZACAO TIMESTAMP 
);

COMMENT ON COLUMN USUARIO.TIPOUSUARIO IS
    '0 -> ADMINITRADOR
1 -> SOLICITANTE
-1 -> PRESTADOR/PARCEIRO';

ALTER TABLE USUARIO ADD CONSTRAINT USUARIO_PK PRIMARY KEY (IDUSUARIO);

-- 2 RODAR ESSES SCRIPTS APOS CRIAR AS TABELAS

ALTER TABLE INTERESSE_ITEM
    ADD CONSTRAINT INTERESSE_ITEM_INTERESSE_FK FOREIGN KEY (IDINTERESSE)
        REFERENCES INTERESSE ( IDINTERESSE );

ALTER TABLE INTERESSE_ITEM
    ADD CONSTRAINT INTERESSE_ITEM_OFERTA_ITEMS_FK FOREIGN KEY (IDOFERTAITEMS)
        REFERENCES OFERTA_ITEMS ( IDOFERTAITEMS );

ALTER TABLE INTERESSE
    ADD CONSTRAINT INTERESSE_OFERTA_FK FOREIGN KEY (IDOFERTA)
        REFERENCES OFERTA (IDOFERTA);

ALTER TABLE INTERESSE
    ADD CONSTRAINT INTERESSE_USUARIO_FK FOREIGN KEY (IDUSUARIO)
        REFERENCES USUARIO (IDUSUARIO);

ALTER TABLE MENSAGEM
    ADD CONSTRAINT MENSAGEM_USUARIO_DES_FK FOREIGN KEY (IDUSUARIODESTINATARIO)
        REFERENCES USUARIO (IDUSUARIO);

ALTER TABLE MENSAGEM
    ADD CONSTRAINT MENSAGEM_USUARIO_REM_FK FOREIGN KEY (IDUSUARIOREMETENTE)
        REFERENCES USUARIO (IDUSUARIO);

ALTER TABLE OFERTA_ITEMS
    ADD CONSTRAINT OFERTA_ITEMS_CATEGORIA_ITEM_FK FOREIGN KEY (IDCATEGORIAITEM)
        REFERENCES CATEGORIA_ITEM (IDCATEGORIAITEM);

ALTER TABLE OFERTA_ITEMS
    ADD CONSTRAINT OFERTA_ITEMS_OFERTA_FK FOREIGN KEY (IDOFERTA)
        REFERENCES OFERTA (IDOFERTA);

ALTER TABLE OFERTA
    ADD CONSTRAINT OFERTA_USUARIO_FK FOREIGN KEY (IDUSUARIO)
        REFERENCES USUARIO (IDUSUARIO);

-- SEQUENCE CATEGORIA ITEM
CREATE SEQUENCE CATEGORIA_ITEM_ID_SEQ; 

CREATE OR REPLACE TRIGGER TR_SEQ_CATEGORIA_ITEM BEFORE INSERT ON CATEGORIA_ITEM FOR EACH ROW 
BEGIN
SELECT CATEGORIA_ITEM_ID_SEQ.NEXTVAL
INTO :NEW.IDCATEGORIAITEM
FROM DUAL;
END;

CREATE SEQUENCE INTERESSE_ID_SEQ; 

CREATE OR REPLACE TRIGGER TR_SEQ_INTERESSE BEFORE INSERT ON INTERESSE FOR EACH ROW 
BEGIN
SELECT INTERESSE_ID_SEQ.NEXTVAL
INTO :NEW.IDINTERESSE
FROM DUAL;
END;


CREATE SEQUENCE INTERESSE_ITEM_ID_SEQ; 

CREATE OR REPLACE TRIGGER TR_SEQ_INTERESSE_ITEM BEFORE INSERT ON INTERESSE_ITEM FOR EACH ROW 
BEGIN
SELECT INTERESSE_ITEM_ID_SEQ.NEXTVAL
INTO :NEW.IDINTERESSEITEM
FROM DUAL;
END;

CREATE SEQUENCE USUARIO_ID_SEQ; 

CREATE OR REPLACE TRIGGER TR_SEQ_USUARIO BEFORE INSERT ON USUARIO FOR EACH ROW 
BEGIN
SELECT USUARIO_ID_SEQ.NEXTVAL
INTO :NEW.IDUSUARIO
FROM DUAL;
END;

CREATE SEQUENCE MENSAGEM_ID_SEQ; 

CREATE OR REPLACE TRIGGER TR_SEQ_MENSAGEM BEFORE INSERT ON MENSAGEM FOR EACH ROW 
BEGIN
SELECT MENSAGEM_ID_SEQ.NEXTVAL
INTO :NEW.IDMENSAGEM
FROM DUAL;
END;

CREATE SEQUENCE OFERTA_ID_SEQ; 

CREATE OR REPLACE TRIGGER TR_SEQ_OFERTA BEFORE INSERT ON OFERTA FOR EACH ROW 
BEGIN
SELECT OFERTA_ID_SEQ.NEXTVAL
INTO :NEW.IDOFERTA
FROM DUAL;
END;

CREATE SEQUENCE OFERTA_ITEMS_ID_SEQ; 

CREATE OR REPLACE TRIGGER TR_SEQ_OFERTA_ITEMS BEFORE INSERT ON OFERTA_ITEMS FOR EACH ROW 
BEGIN
SELECT OFERTA_ITEMS_ID_SEQ.NEXTVAL
INTO :NEW.IDOFERTAITEMS
FROM DUAL;
END;

-- RELATÓRIO
-- 
-- CREATE TABLE                             7
-- CREATE INDEX                             0
-- ALTER TABLE                             16
-- CREATE VIEW                              0
-- ALTER VIEW                               0
-- CREATE PACKAGE                           0
-- CREATE PACKAGE BODY                      0
-- CREATE PROCEDURE                         0
-- CREATE FUNCTION                          0
-- CREATE TRIGGER                           0
-- ALTER TRIGGER                            0
-- CREATE COLLECTION TYPE                   0
-- CREATE STRUCTURED TYPE                   0
-- CREATE STRUCTURED TYPE BODY              0
-- CREATE CLUSTER                           0
-- CREATE CONTEXT                           0
-- CREATE DATABASE                          0
-- CREATE DIMENSION                         0
-- CREATE DIRECTORY                         0
-- CREATE DISK GROUP                        0
-- CREATE ROLE                              0
-- CREATE ROLLBACK SEGMENT                  0
-- CREATE SEQUENCE                          0
-- CREATE MATERIALIZED VIEW                 0
-- CREATE MATERIALIZED VIEW LOG             0
-- CREATE SYNONYM                           0
-- CREATE TABLESPACE                        0
-- CREATE USER                              0
-- 
-- DROP TABLESPACE                          0
-- DROP DATABASE                            0
-- 
-- REDACTION POLICY                         0
-- 
-- ORDS DROP SCHEMA                         0
-- ORDS ENABLE SCHEMA                       0
-- ORDS ENABLE OBJECT                       0
-- 
-- ERRORS                                   0
-- WARNINGS                                 0
